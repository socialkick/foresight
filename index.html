<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Foresight - Weather App</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">

</head>
<body>


    <h1 style="font-size:1.2em; text-transform:uppercase;">Foresight</h1>
    <p>Weather App</p>
    <br>

    <div id="results">
        <h2 class="city"><span style="font-size:0.6em; font-weight:normal;">Loading Last Search...</span></h2>
        <p class="timestamp"></p>
        <p class="temperature"></p>
        <p class="humidity"></p>
        <p class="windSpeed"></p>
    </div>

<<<<<<< HEAD
=======
    <br>

    <input id="zipCodeInput" type="search" placeholder="enter a  Zip Code" autofocus />
    <p class="errorMessage"></p>



>>>>>>> parent of 46b7a9a... Changed ZipCodeApi to OpenCageData
    <script src="js/modernizr-2.8.3.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/2.3.1/firebase.js"></script>
    <script src="js/main.js"></script>


    <script>

<<<<<<< HEAD
    // OpenCageData variables - http://geocoder.opencagedata.com/
        var ocdApiUrl = "http://api.opencagedata.com/geocode/v1/json?q=",
            ocdApiKey = "4ace6317360a3946395ae4d807e84cd1",
            locationInput = null,
            locationData = null,
            locationName = null,
            inputFormatting = function(){
                locationName = locationInput;
                var checkName = function(input){
                    if ( input.city !== undefined ) { locationName = input.city; }
                    else if ( locationData.results[1].components.city !== undefined ) { locationName = locationData.results[1].components.city; }
                    else if ( input.administrative !== undefined ) { locationName = input.administrative }
                    else if ( input.county !== undefined ) { locationName = input.county; }
                    else if ( input.state !== undefined ) { locationName = input.state; }
                    else if ( input.country!== undefined ) { locationName = input.country; }
                    console.log(locationName);
                }; checkName(locationData.results[0].components);
                var locationExtra = '';
                var checkState = function(data){
                    if ( locationName !== data.state && data.state !== undefined ) { locationExtra = ", " + data.state }
                    else if ( locationName == data.state && data.country_code !== undefined ) { locationExtra = ", " + (data.country_code).toUpperCase() }
                }; checkState(locationData.results[0].components);
                locationName = locationName + locationExtra;
            },
            forecastURL = null;
=======
    // ZipCodeApi variables - https://www.zipcodeapi.com/ --------------------
        var zcApiKey /* Client-side API Key */ = "js-mDrU9rkkUvySyufyPauQEsOyt7eckpIH3aCcBWxvr5o0ADypO3gsw41ZbgbwGUeJ",
            newZipCode = 94501,
            zipCodeInput = null,
            zcRequestUrl = null,
            zipCodeData = null;
>>>>>>> parent of 46b7a9a... Changed ZipCodeApi to OpenCageData

    // Forecast.Io variables - https://developer.forecast.io/
        var fcApiUrl = "https://api.forecast.io/forecast",
            fcApiKey = "2dcaef59f4ef9b896eb1af4ad29d9aa2",
            lat = null,
            lng = null,
            fcRequestUrl = null,
            weatherData = null;

    // Firebase variables - https://foresightweather.firebaseio.com/
        var fireBase = new Firebase("https://foresightWeather.firebaseio.com/"),
            dataObject = null;

<<<<<<< HEAD
    // Other Global Variables
        var failure = function(failurPoint){
=======
    // Time Variables -------------------
        var dt = new Date(), hours = dt.getHours(), minutes = dt.getMinutes(), meridiem = "am";
            if (hours > 12) { hours -= 12; meridiem = "pm"; }
            if (minutes < 10) { minutes = "0" + minutes; }
        var timestamp = hours + ":" + minutes + meridiem;

    // Global Variables -------------------
        var populateHtml = function() {
                fireBase.on("value", function (snapshot) {
                    var lastSnapshot = snapshot.val();
                    $('.city').text(lastSnapshot.newZipCode.city);
                    $('.timestamp').text("At Time: " + lastSnapshot.timestamp);
                    $('.temperature').text("Temperature: " + lastSnapshot.newForecast.currently.temperature + "°");
                    $('.humidity').text("Humidity: " + (lastSnapshot.newForecast.currently.humidity) * 100 + "%");
                    $('.windSpeed').text("Wind Speed: " + lastSnapshot.newForecast.currently.windSpeed + "mph");
                    hideErrorMessage();
                    showResults();
                }, function (errorObject) {
                    console.log("The read failed: " + errorObject.code);
                });
            },
            failure = function(failurePoint){
>>>>>>> parent of 46b7a9a... Changed ZipCodeApi to OpenCageData
                showErrorMessage();
                return (console.log("Failure Point: " + failurePoint))
            },
            success = function(details){
                hideErrorMessage();
                return (console.log("Success! " + details))
            },
            showResults = function(){ $('#results').css('display','block') },
            hideResults = function(){ $('#results').css('display','none') },
            showErrorMessage = function(){ $('.errorMessage').css('display','block'); },
            hideErrorMessage = function(){ $('.errorMessage').css('display','none') };


// -------------------- STEPS --------------------

    // Getting location data from OpenCageData
//        var getLocationData = function(){
//            $.getJSON(ocdRequestUrl, function(data) {
//                locationData = data;
//                fireBase.child("location").set(locationData);
//                inputFormatting();
//                fireBase.child("locationName").set(locationName);
//                var lat = locationData.results[0].geometry.lat,
//                        lng = locationData.results[0].geometry.lng;
//                fcRequestUrl = fcApiUrl + "/" + fcApiKey  + "/" + lat + "," + lng + "?callback=?";
//                fireBase.child("forecastRequestURL").set(fcRequestUrl);
//            });
//        };

    // Retrieving the forecast request URL from Firebase
        var retrieveForecastURL = function(){
            fireBase.on("value", function (snapshot) {
                var lastSnapshot = snapshot.val();
                forecastURL = lastSnapshot.forecastRequestURL;
            }, function (errorObject) {
                console.log("The read failed: " + errorObject.code);
            });
        };

    // Getting the forecast data from Forecast.io
        var getForecastData = function(){
            $.getJSON(forecastURL, function(data){
                weatherData = data;
                fireBase.child("forecast").set(weatherData);
            }).error(function(){
                failure("getting forecast.io JSON data.");
            });
        };

    // Populating the forecast data to HTML
        var populateHtml = function() {
            fireBase.on("value", function (snapshot) {
                var lastSnapshot = snapshot.val();
                $('.locationName').text(lastSnapshot.locationName);
                $('.temperature').text("Temperature: " + lastSnapshot.forecast.currently.temperature + "°");
                $('.humidity').text("Humidity: " + Math.floor((lastSnapshot.forecast.currently.humidity) * 100) + "%");
                $('.windSpeed').text("Wind Speed: " + lastSnapshot.forecast.currently.windSpeed + "mph");
                $('.nextHour').text("Next Hour: " + lastSnapshot.forecast.minutely.summary);
                $('.nextDay').text("Next 24 Hrs: " + lastSnapshot.forecast.hourly.summary);
                $('.nextWeek').text("Next 7 Days: " + lastSnapshot.forecast.daily.summary);
                hideErrorMessage();
            }, function (errorObject) {
                console.log("The read failed: " + errorObject.code);
            });
        };


// ------------------- Putting it All Together -------------------

        $(document).ready(function(){
<<<<<<< HEAD
//            populateHtml();
            $('#locationInput').keyup(function(e) {
                locationInput = $('#locationInput').val();
                if (e.keyCode == 13) {
                    hideResults();
                    ocdRequestUrl = ocdApiUrl + locationInput + "&key=" + ocdApiKey;
//                    getLocationData();
                    $.getJSON(ocdRequestUrl, function(data) {
                        locationData = data;
                        fireBase.child("location").set(locationData);
                        inputFormatting();
                        fireBase.child("locationName").set(locationName);
                        var lat = locationData.results[0].geometry.lat,
                                lng = locationData.results[0].geometry.lng;
                        fcRequestUrl = fcApiUrl + "/" + fcApiKey  + "/" + lat + "," + lng + "?callback=?";
                        fireBase.child("forecastRequestURL").set(fcRequestUrl);
                    });
                    retrieveForecastURL();
                    getForecastData();
                    populateHtml();
                    showResults();
                    success("Hooray!");
                    $('#locationInput').val('');
                }
            });

=======
            populateHtml();
            $('#zipCodeInput').keyup(function(e) {
                zipCodeInput = $('#zipCodeInput').val();
                if (e.keyCode == 13) {
                    hideResults();
                    zcRequestUrl = "https://www.zipcodeapi.com/rest/" + zcApiKey + "/info.json/" + zipCodeInput + "/degrees";
                    $.getJSON(zcRequestUrl, function(data) {
                        zipCodeData = data;
                        fireBase.child("newZipCode").set(zipCodeData);
                        lat = zipCodeData.lat;
                        lng = zipCodeData.lng;
                        fcRequestUrl = fcApiUrl + "/" + fcApiKey  + "/" + lat + "," + lng + "?callback=?";
                        $.getJSON(fcRequestUrl, function(data){
                            weatherData = data;
                            console.log(weatherData);
                            fireBase.child("newForecast").set(weatherData);
                            fireBase.child("timestamp").set(timestamp);
                            success();
                            populateHtml();
                        })
                        .error(function(){
                            failure("getting forecast.io JSON data.");
                        });
                    })
                    .error(function(){
                        failure("getting zip code JSON data.");
                    });
                }
            });
>>>>>>> parent of 46b7a9a... Changed ZipCodeApi to OpenCageData
        });

    </script>


</body>
</html>

















